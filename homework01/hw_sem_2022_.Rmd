---
title: "Домашно задание по СЕМ практикум"
author: "Давид Петров, СИ, гр. 4, ф.н. 62596"
date: "`r format(Sys.time(), '%d %B %Y')`"
output:
  html_document:
    df_print: paged
    toc: false
    toc_float: true
    number_sections: false
  pdf_document: default
  word_document: default
---

<br>

При решаване на задачите може да използвате вградени функции и команди, които **не** изискват зареждане на пакет или извикване от типа `packageName::fun()`.

<br>

### Задача 1

В тесте от $32$ карти има $4$ маркирани. Тестето е разбъркано и раздадено на $4$ играчи. Чрез подходяща симулация намерете приближение на вероятността на събитието *"на всеки играч се пада една маркирана карта"*.

## Решение

Ще моделираме аналитично по формулата на Бейс, за да си направим sanity check на емпиричните резултати. Нека за $i \in {1,2,3,4}$ въведем $X_i :=$ брой маркирани карти в ръката (от 8 карти) на $i$-ти играч. Всяко $X_i$ е хипергеометрично разпределена случайна величина, обаче четирите са зависими и трябва да намерим с какви параметри да направим сметката. Реално сумата им е инварианта 4, така че търсим $\mathbb{P}(X_1 = 1; X_2 = 1; X_3 = 1)$. Ползваме Бейс в съвкупност, т.е.: $\mathbb{P}(X_1 = 1; X_2 = 1; X_3 = 1) = \mathbb{P}(X_1 = 1 \mid X_2 = 1; X_3 = 1)\cdot \mathbb{P}(X_2 = 1 \mid X_3 = 1)\cdot \mathbb{P}(X_3 = 1)$ 

Сега вече е лесно: 


$X_3 \sim HG(32, 4, 8)$ 


$X_2 \mid X_3 = 1 \sim HG(24, 3, 8)$ 


$X_1 \mid X_2 = 1; X_3 = 1 \sim HG(16,2,8)$

С леката адаптация към API-а на R, можем директно да оставим сметките на машината:

```{r}
pX3 <- dhyper(1, 4, 32-4, 8)
pX2condX3 <- dhyper(1, 3, 24-3,8)
pX1condX3X2 <- dhyper(1, 2, 16 - 2, 8)
totalP <- pX3 * pX1condX3X2 * pX2condX3
print(totalP)
```

Сега подхождаме по същество към емпиричното задание.

```{r}
marked <- c(1:4)

# симулираме раздаване
sim.deals <- function() {
  # списък от 28 немаркирани и 4 маркирани стойности
  deck <- c(rep(FALSE, 28), rep(TRUE, 4))
  
  # разбъркваме ги случайно
  cards <- sample(deck)
  
  # и раздаваме на 4-ма играчи
  dealsByPlayer <- matrix(cards, nrow=4)
  
  # проверява дали даден играч (ред в матрицата)
  # има маркирана карта
  playerHasMarked <- function(row) {
    any(row)
  }
  
  #' проверяваме дали всеки играч има маркирана карта,
  #' което е еквивалентно на нашата дефиниция за успех,
  #' понеже всеки да има маркирана е възможно т.т.к 
  #' всеки има точно една маркирана
  all(apply(dealsByPlayer, 1, playerHasMarked))
}

# повтаряме симулацията Nrep пъти
# за да приближим вероятността емпирично
prob.deals <- function(Nrep) {
  rs <- replicate(Nrep, sim.deals())
  sum(rs)/length(rs)
}

# приближение със 100 000 повторения
prob.deals(100000)
```
Както можем да забележим, емпиричното приближение е доста дробо след 100000 повторения.


### Задача 2

В кутия има $5$ зелени, $7$ сини и $7$ жълти топки. Симулирайте $n$ тегления на топка с връщане. Проверете хипотезата, че в кутията има еднакъв брой топки от трите цвята. Повторете $10000$ пъти за $n=50, 100, 200, 500, 1000$. Колко често заключението на теста е вярно? Представете чрез подходяща графика честотата на вярно заключение в зависимост от $n$.

```{r}
# Initialize variables
balls <- rep(c("green", "blue", "yellow"), c(5, 7, 7))
n_values <- c(50, 100, 200, 500, 1000)
n_trials <- 10000
p_value_threshold <- 0.05  # Significance level
correct_counts <- numeric(length(n_values))

# Loop through each value of n
for (i in 1:length(n_values)) {
  n <- n_values[i]
  
  # Loop through each trial
  for (j in 1:n_trials) {
    # Simulate n draws with replacement
    draws <- sample(balls, size = n, replace = TRUE)
    
    # Conduct a chi-squared goodness-of-fit test
    result <- chisq.test(table(draws))
    
    # Increment the correct count if the p-value is greater than the threshold
    if (result$p.value > p_value_threshold) {
      correct_counts[i] <- correct_counts[i] + 1
    }
  }
}

# Divide the correct counts by the number of trials to get the frequencies
frequencies <- correct_counts / n_trials

# Plot the frequencies as a function of n
barplot(frequencies, xlab = "n", ylab = "Frequency of correct conclusion", main = "Bar plot of frequencies", names.arg = n_values)
#plot(n_values, frequencies, type = "l", xlab = "n", ylab = "Frequency of correct conclusion")
```


### Задача 3

В кутия има $5$ зелени, $5$ сини и $5$ жълти топки. Симулирайте $n$ тегления на топка с връщане. Проверете хипотезата, че в кутията има еднакъв брой топки от трите цвята. Повторете $10000$ пъти за $n=50, 100, 200, 500, 1000$. Колко често заключението на теста е вярно? Представете чрез подходяща графика честотата на вярно заключение в зависимост от $n$.
